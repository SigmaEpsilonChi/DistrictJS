<!DOCTYPE html>
<html>
    <head>
        <title>District</title>
        <script src="http://code.jquery.com/jquery.min.js"></script>

        <link rel="icon" type="image/png" href="/favicon.png"/>
        <link rel="stylesheet" href="/css/main.css">
        <link rel="stylesheet" href="./css/district.css">

        <meta charset="utf-8">
    </head>
    <body>
        <div id="nav-container"></div>
        <script type="text/javascript">
        $(document).ready(function() {
        $('#nav-container').load('/nav.html');
        });
        </script>

        <div class="deck" id="deck">
        </div>

        <div class="advance" id="advance" onclick="advance()">
            <a href="javascript:void(0)">Next...</a>
        </div>


        <script type="text/javascript">
            var slides = [];
            var puzzleWindows = [];

            var slideSpecs = [
                {
                    title: "Welcome to Rugton",
                    description:
                    "<p>Alice and Bob start a town, but they have a problem. Alice likes Red carpets, but Bob likes Blue.</p><p>They decide to split the floor into 2 separate carpet districts.</p><p>For now, everyone is happy.</p>",
                    query: "?=&x=2&y=1&s=-1&t=0&g=2&r=1&p=01",
                },
                {
                    title: "Democracy is Born",
                    description: "<p>Two friends move in, so a vote is held for new carpets.</p><p>Both districts tie, so they compromise on Grey.</p>",
                    query: "?=&x=2&y=2&s=-1&t=0&g=2&r=1&p=0110",
                },
                {
                    title: "Rugton Expands",
                    description: "<p>A third group is added to accomodate new arrivals, and a new vote is held.</p><p>Overall, Rugtonians are pretty happy with their carpet.</p>",
                    query: "?=&x=2&y=3&s=-1&t=0&g=3&r=1&p=001011",
                },
                {
                    title: "Red Carpeters Take Charge",
                    description: "<p>Borders are redrawn once again, but this time Red gains power.</p><p>From now on, they get to divide up the floor.</p><p>They were elected, after all.<p>",
                    query: "?=&x=3&y=3&s=1&t=1&g=3&r=1&p=100101001",
                },
                {
                    title: "Cracking",
                    description: "<p>Rugton is perfectly split on their preferred color.</p><p>Somehow, the floor is still mostly Red. About 25% of Rugtonians feel kind of cheated.</p><p>Anti-Red sentiment begins to fester.</p>",
                    query: "?=&x=4&y=3&s=2&t=0&g=4&r=1&p=000000111111",
                },
                {
                    title: "Packing",
                    description: "<p>The share of Red voters begins to dwindle.</p><p>Their share of the floor does not.</p>",
                    query: "?=&x=5&y=3&s=1&t=0&g=3&r=1&p=001110011100111",
                },
                {
                    title: "Linking",
                    description: "<p>The Red population shrinks and fractures.</p><p>Nonetheless, the Red leadership finds a clever way to keep control of the floor.</p>",
                    query: "?=&x=6&y=3&s=1&t=0&g=3&r=1&p=001100011110110011",
                },
                {
                    title: "God Intervenes.",
                    description: "<p>\"Hey wait a minute,\" says God,</p><p>\"This sucks. New rule: From now on, each district picks two colors. Put them in stripes on the floor or something.\"</p><p>This is a problem for Team Red.</p>",
                    query: "?=&x=6&y=3&s=0&t=0&g=3&r=2&p=001100011110110011",
                },
                /*
                {
                    title: "Another Title!",
                    description: "Hey look at that another description too what are the odds",
                    query: "?=&x=5&y=4&s=0&t=0&g=4&r=1&p=00011000111100011000",
                },
                */
            ];

            var slideIndex = 0;
            var slideTotal = slides.length;

            appendSlide = function(spec){
                var deck = document.getElementById("deck");

                if (slideIndex > 0) {
                    var ruler = document.createElement('div');
                    ruler.className = "ruler";
                    deck.appendChild(ruler);
                    ruler.innerHTML = "<hr>";
                }

                var slide = document.createElement('div');
                slide.className = "slide";
                deck.appendChild(slide);

                var words = document.createElement('div');
                words.className = "words";
                slide.appendChild(words);

                var title = document.createElement('div');
                title.className = "title";
                title.innerHTML = spec.title;
                words.appendChild(title);

                var description = document.createElement('div');
                description.className = "description";
                description.innerHTML = spec.description;
                words.appendChild(description);

                var puzzle = document.createElement('div');
                puzzle.className = "puzzle";
                slide.appendChild(puzzle);

                var embedURL = "./embed.html"+spec.query;
                puzzle.innerHTML = "<iframe id=\"frame\" src=\""+embedURL+"\" width=\"600px\" height=\"600px\" style=\"border:1px solid black\"></iframe>";

                var puzzleFrame = puzzle.querySelector("#frame");
                puzzleFrame.addEventListener('load', function(){
                    puzzleFrame.contentWindow.setCompletionCallback(advance);

                    slides.push(slide);
                    puzzleWindows.push(puzzleFrame.contentWindow);

                    slide.addEventListener("mouseenter", function(event){
                        setActiveSlide(event.target);
                    });
                    slide.addEventListener("touchstart", function(event){
                        setActiveSlide(event.target);
                    });

                    setActiveSlide(slide);
                });

                slideIndex++;

                return slide;
            }

            setActiveSlide = function(targetSlide){
                for (var i = 0; i < slides.length; i++) {
                    if (slides[i] == targetSlide) puzzleWindows[i].setPause(false);
                    else puzzleWindows[i].setPause(true);
                }
            }

            advance = function(){
                if (slideSpecs.length > 0) {
                    var slide = appendSlide(slideSpecs.shift());
                    slide.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                    });
                    if (slideSpecs.length == 0) {
                        document.getElementById("advance").style.visibility = "hidden";
                    }
                }
            }

            advance();
        </script>

        <div id="footer-container"></div>
        <script type="text/javascript">
        $(document).ready(function() {
        $('#footer-container').load('/footer.html');
        });
        </script>
    </body>
</html>
